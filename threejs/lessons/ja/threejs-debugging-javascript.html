<!DOCTYPE html>
<!-- this file is auto-generated from threejs/lessons/ja/threejs-debugging-javascript.md. Do not edited directly -->
<!--
Copyright 2018, Google Inc.
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are
met:

*   Redistributions of source code must retain the above copyright
    notice, this list of conditions and the following disclaimer.

*   Redistributions in binary form must reproduce the above
    copyright notice, this list of conditions and the following disclaimer
    in the documentation and/or other materials provided with the
    distribution.

*   Neither the name of Google Inc. nor the names of their
    contributors may be used to endorse or promote products derived from
    this software without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
"AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-->
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="THREE.jsでJavaScriptをデバッグする方法">
<meta name="keywords" content="webgl graphics three.js">
<meta name="thumbnail" content="https://threejsfundamentals.org/threejs/lessons/screenshots/threejs-debugging-javascript_ja.jpg">

<meta property="og:title" content="Three.jsでのJavaScriptデバッグ">
<meta property="og:type" content="website">
<meta property="og:image" content="https://threejsfundamentals.org/threejs/lessons/screenshots/threejs-debugging-javascript_ja.jpg">
<meta property="og:description" content="THREE.jsでJavaScriptをデバッグする方法">
<meta property="og:url" content="https://threejsfundamentals.org/threejs/lessons/ja/threejs-debugging-javascript.html">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@greggman">
<meta name="twitter:creator" content="@greggman">
<meta name="twitter:domain" content="threejsfundamentals.org">
<meta name="twitter:title" content="Three.jsでのJavaScriptデバッグ">
<meta name="twitter:url" content="https://threejsfundamentals.org/threejs/lessons/ja/threejs-debugging-javascript.html">
<meta name="twitter:description" content="THREE.jsでJavaScriptをデバッグする方法">
<meta name="twitter:image:src" content="https://threejsfundamentals.org/threejs/lessons/screenshots/threejs-debugging-javascript_ja.jpg">

  <link rel="alternate" hreflang="en" href="https://webglfundamentals.org/threejs/lessons/threejs-debugging-javascript.html">
  <link rel="alternate" hreflang="fr" href="https://webglfundamentals.org/threejs/lessons/fr/threejs-debugging-javascript.html">
  <link rel="alternate" hreflang="ja" href="https://webglfundamentals.org/threejs/lessons/ja/threejs-debugging-javascript.html">
  <link rel="alternate" hreflang="kr" href="https://webglfundamentals.org/threejs/lessons/kr/threejs-debugging-javascript.html">
  <link rel="alternate" hreflang="ru" href="https://webglfundamentals.org/threejs/lessons/ru/threejs-debugging-javascript.html">
  <link rel="alternate" hreflang="zh_cn" href="https://webglfundamentals.org/threejs/lessons/zh_cn/threejs-debugging-javascript.html">




<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@graph":[
    {
      "@type":"WebSite",
      "@id":"https://threejsfundamentals.org/#website",
      "url":"https://threejsfundamentals.org/",
      "name":"ThreejsFundamentals"
    },
    {
      "@type":"ImageObject",
      "@id":"https://threejsfundamentals.org/threejs/lessons/ja/threejs-debugging-javascript.html#primaryimage",
      "url":"https://threejsfundamentals.org/threejs/lessons/screenshots/threejs-debugging-javascript_ja.jpg",
      "width":1200,
      "height":630
    },
    {
      "@type":"WebPage",
      "@id":"https://threejsfundamentals.org/threejs/lessons/ja/threejs-debugging-javascript.html#webpage",
      "url":"https://threejsfundamentals.org/threejs/lessons/ja/threejs-debugging-javascript.html",
      "inLanguage":"ja",
      "name":"Three.jsでのJavaScriptデバッグ",
      "keywords":"webgl graphics three.js programming",
      "isPartOf":{
        "@id":"https://threejsfundamentals.org/#website"
      },
      "primaryImageOfPage":{
        "@id":"https://threejsfundamentals.org/threejs/lessons/ja/threejs-debugging-javascript.html#primaryimage"
      }
    }
  ]
}
</script>

<title>Three.jsでのJavaScriptデバッグ</title>
<link href="/threejs/lessons/resources/threejsfundamentals-icon.png" rel="shortcut icon" type="image/png">
<link rel="apple-touch-icon" href="/threejs/lessons/resources/threejsfundamentals-icon.png">
<link rel="icon" href="/threejs/lessons/resources/threejsfundamentals-icon.png">

<link rel="stylesheet" href="/threejs/lessons/lang.css">
<link rel="stylesheet" href="/threejs/lessons/resources/lesson.css">
</head>
<body>
<div class="threejs_navbar">
  <div>
    <select class="language">
    <option value="/threejs/lessons/threejs-debugging-javascript.html" >English</a>
    <option value="/threejs/lessons/fr/threejs-debugging-javascript.html" >Français</a>
    <option value="/threejs/lessons/ja/threejs-debugging-javascript.html" selected>日本語</a>
    <option value="/threejs/lessons/kr/threejs-debugging-javascript.html" >한국어</a>
    <option value="/threejs/lessons/ru/threejs-debugging-javascript.html" >Русский</a>
    <option value="/threejs/lessons/zh_cn/threejs-debugging-javascript.html" >中文</a>
</select>


    <a href="#toc">目次</a>
  </div>
</div>
<div class="threejs_header">
  <h1><a href="/threejs/lessons/ja/">threejsfundamentals.org</a></h1>
<style>
#forkongithub a {
    background: #000;
    color: #fff;
    text-decoration: none;
    font-family: arial,sans-serif;
    text-align: center;
    font-weight: bold;
    padding: 5px 40px;
    font-size: 0.9rem;
    line-height: 2rem;
    position: relative;
    transition: 0.5s;
    display: block;
    width: 300px;
    position: absolute;
    top: 0;
    right: 0;
    transform: translateX(150px) rotate(45deg) translate(10px,70px);
    box-shadow: 4px 4px 10px rgba(0,0,0,0.8);
    pointer-events: auto;
}
#forkongithub a:hover {
    background: #c11;
    color: #fff;
}
#forkongithub a::before,#forkongithub a::after {
    content: "";
    width: 100%;
    display: block;
    position: absolute;
    top: 1px;
    left: 0;
    height: 1px;
    background: #fff;
}
#forkongithub a::after {
    bottom: 1px;
    top: auto;
}

#forkongithub{
    z-index: 9999;
    /* needed for firefox */
    overflow: hidden;
    width: 300px;
    height: 300px;
    position: absolute;
    right: 0;
    top: 0;
    pointer-events: none;
}
#forkongithub svg{
  width: 1em;
  height: 1em;
  vertical-align: middle;
}
@media (max-width: 900px) {
    #forkongithub a{
        line-height: 1.2rem;
    }
}
@media (max-width: 700px) {
  #forkongithub {
    display: none;
  }
}
@media (max-width: 410px) {
    #forkongithub a{
        font-size: 0.7rem;
        transform: translateX(150px) rotate(45deg) translate(20px,40px);
    }
}

</style>
<div id="forkongithub"><a href="https://github.com/gfxfundamentals/threejsfundamentals">Fix, Fork, Contribute <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="100%" height="100%" viewBox="0 0 136 133" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
    <g transform="matrix(3.92891,0,0,3.92891,67.867,129.125)">
        <path d="M0,-31.904C-8.995,-31.904 -16.288,-24.611 -16.288,-15.614C-16.288,-8.417 -11.621,-2.312 -5.148,-0.157C-4.333,-0.008 -4.036,-0.511 -4.036,-0.943C-4.036,-1.329 -4.05,-2.354 -4.058,-3.713C-8.589,-2.729 -9.545,-5.897 -9.545,-5.897C-10.286,-7.779 -11.354,-8.28 -11.354,-8.28C-12.833,-9.29 -11.242,-9.27 -11.242,-9.27C-9.607,-9.155 -8.747,-7.591 -8.747,-7.591C-7.294,-5.102 -4.934,-5.821 -4.006,-6.238C-3.858,-7.29 -3.438,-8.008 -2.972,-8.415C-6.589,-8.826 -10.392,-10.224 -10.392,-16.466C-10.392,-18.244 -9.757,-19.698 -8.715,-20.837C-8.883,-21.249 -9.442,-22.905 -8.556,-25.148C-8.556,-25.148 -7.188,-25.586 -4.076,-23.478C-2.777,-23.84 -1.383,-24.02 0.002,-24.026C1.385,-24.02 2.779,-23.84 4.08,-23.478C7.19,-25.586 8.555,-25.148 8.555,-25.148C9.444,-22.905 8.885,-21.249 8.717,-20.837C9.761,-19.698 10.392,-18.244 10.392,-16.466C10.392,-10.208 6.583,-8.831 2.954,-8.428C3.539,-7.925 4.06,-6.931 4.06,-5.411C4.06,-3.234 4.04,-1.477 4.04,-0.943C4.04,-0.507 4.333,0 5.16,-0.159C11.628,-2.318 16.291,-8.419 16.291,-15.614C16.291,-24.611 8.997,-31.904 0,-31.904" style="fill:white;"/>
    </g>
</svg>
</a></div>

</div>


<div class="container">
  <div class="lesson-title">
    <h1>Three.jsでのJavaScriptデバッグ</h1>
  </div>
  <div class="lesson">
    <div class="lesson-main">
      <p>この記事のほとんどはTHREE.jsのデバッグと言うより、一般的なJavaScriptのデバッグの内容です。THREE.js初心者にはJavaScript初心者も多いので、この記事を読んで困った時に簡単に解決できるようになると良いと思います。</p>
<p>デバッグは大きなトピックであり、この記事で全てをカバーできませんが、JavaScriptに慣れていない場合はいくつかのヒントを得られると思います。デバッグに関しては、時間をかけて学ぶ事を強くお勧めします。デバッグはあなたの学習を大いに助けてくれます。</p>
<h2 id="-">ブラウザの開発者ツールを学ぶ</h2>
<p>全てのブラウザには開発者ツールがあります。
<a href="https://developers.google.com/web/tools/chrome-devtools/">Chrome</a>,
<a href="https://developer.mozilla.org/en-US/docs/Tools">Firefox</a>, 
<a href="https://developer.apple.com/safari/tools/">Safari</a>, 
<a href="https://docs.microsoft.com/en-us/microsoft-edge/devtools-guide">Edge</a>.</p>
<p>Chromeでは <code class="notranslate" translate="no">⋮</code> アイコンをクリックし、その他のツール -&gt; デベロッパーツールを選択すると開発者ツールが表示されます。そこにはキーボードのショートカットも表示されています。</p>
<div class="threejs_center"><img class="border" src="../resources/images/devtools-chrome.jpg" style="width: 789px;"></div>

<p>Firefoxでは <code class="notranslate" translate="no">☰</code> アイコンをクリックし、&quot;ウェブ開発&quot;から&quot;開発者ツール&quot;を選択します。</p>
<div class="threejs_center"><img class="border" src="../resources/images/devtools-firefox.jpg" style="width: 786px;"></div>

<p>Safariでは詳細設定メニューから開発メニューを有効にする必要があります。</p>
<div class="threejs_center"><img class="border" src="../resources/images/devtools-enable-safari.jpg" style="width: 775px;"></div>

<p>次に開発メニューで&quot;Webインスペクタの表示/接続&quot;を選択します。</p>
<div class="threejs_center"><img class="border" src="../resources/images/devtools-safari.jpg" style="width: 777px;"></div>

<p><a href="https://developers.google.com/web/tools/chrome-devtools/remote-debugging/">Chromeを使ってAndroidやタブレットでChrome上で実行されているウェブページをデバッグする事もできます</a>。
同様にSafariでは<a href="https://www.google.com/search?q=safari+remote+debugging+ios">iPhoneやiPadでSafari上で実行されているウェブページをPCでデバッグする事ができます</a>。</p>
<p>私はChromeを一番よく知ってるのでChromeを例にしますが、ほとんどのブラウザは似たような機能を持っているため、全てのブラウザで簡単に同じ機能を適用できるはずです。</p>
<h2 id="-">キャッシュをオフにする</h2>
<p>ブラウザはダウンロードしたデータを再利用します。これはウェブサイトを2回目に訪れた際、サイトを表示するために必要な多くのファイルは再びダウンロードされず、ユーザーにとって素晴らしい事です。</p>
<p>一方でこれはウェブ開発に悪い影響を与える可能性があります。PC上でファイルを変更しリロードしても、前回ダウンロードしたバージョンを使用しているため変更内容が表示されません。</p>
<p>ウェブ開発中の解決策の1つは、キャッシュをオフにする事です。これによりブラウザは常に最新バージョンのファイルを取得する事ができます。</p>
<p>最初にデベロッパーツールのSettingsメニューを選択します。</p>
<div class="threejs_center"><img class="border" src="../resources/images/devtools-chrome-settings.jpg" style="width: 778px"></div>

<p>次に &quot;Disable Cache (while DevTools is open)&quot; を選択します。</p>
<div class="threejs_center"><img class="border" src="../resources/images/devtools-chrome-disable-cache.jpg" style="width: 779px"></div>

<h2 id="javascript-">JavaScriptコンソールを使用する</h2>
<p>全てのdevtoolsの中には <em>console</em> があります。ここには警告やエラーメッセージが表示されます。</p>
<p><strong>メッセージを読みましょう!!</strong></p>
<p>一般的にはメッセージは1つか2つしかありません。</p>
<div class="threejs_center"><img class="border" src="../resources/images/devtools-no-errors.jpg" style="width: 779px"></div>

<p>もし他のメッセージがあれば<strong>メッセージを読みましょう</strong>。例えば</p>
<div class="threejs_center"><img class="border" src="../resources/images/devtools-errors.jpg" style="width: 779px"></div>

<p>&quot;three&quot;を&quot;threee&quot;とスペルミスしました。</p>
<p>以下のように <code class="notranslate" translate="no">console.log</code> であなた自身がconsoleに情報を表示する事もできます。</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-js">console.log(someObject.position.x, someObject.position.y, someObject.position.z);
</code></pre>
<p>さらにクールな事にオブジェクトのログを記録したり検査する事ができます。例えば<a href="threejs-load-gltf.html">gLTFの記事</a>からルートシーンのオブジェクトをログに表示できます。</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-js">  {
    const gltfLoader = new GLTFLoader();
    gltfLoader.load(&#39;resources/models/cartoon_lowpoly_small_city_free_pack/scene.gltf&#39;, (gltf) =&gt; {
      const root = gltf.scene;
      scene.add(root);
+      console.log(root);
</code></pre>
<p>そしてそのオブジェクトをJavaScriptコンソールで展開できます。</p>
<div class="threejs_center"><img class="border" src="../resources/images/devtools-console-object.gif"></div>

<p>スタックトレースを含む赤色メッセージを表示する場合は <code class="notranslate" translate="no">console.error</code> を使う事ができます。</p>
<h2 id="-">データを画面に表示させる</h2>
<p>もう1つの分かりやすい方法は <code class="notranslate" translate="no">&lt;div&gt;</code> や <code class="notranslate" translate="no">&lt;pre&gt;</code> を追加しデータを入れる事です。</p>
<p>最も分かりやすい方法はいくつかのHTML要素を作成する事です。</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-html">&lt;canvas id=&quot;c&quot;&gt;&lt;/canvas&gt;
+&lt;div id=&quot;debug&quot;&gt;
+  &lt;div&gt;x:&lt;span id=&quot;x&quot;&gt;&lt;/span&gt;&lt;/div&gt;
+  &lt;div&gt;y:&lt;span id=&quot;y&quot;&gt;&lt;/span&gt;&lt;/div&gt;
+  &lt;div&gt;z:&lt;span id=&quot;z&quot;&gt;&lt;/span&gt;&lt;/div&gt;
+&lt;/div&gt;
</code></pre>
<p>キャンバスの上に残るようにスタイルを整えます（キャンバスがページを埋めていると仮定します）。</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-html">&lt;style&gt;
#debug {
  position: absolute;
  left: 1em;
  top: 1em;
  padding: 1em;
  background: rgba(0, 0, 0, 0.8);
  color: white;
  font-family: monospace;
}
&lt;/style&gt;
</code></pre>
<p>そして要素を探して内容を設定します。</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-js">// at init time
const xElem = document.querySelector(&#39;#x&#39;);
const yElem = document.querySelector(&#39;#y&#39;);
const zElem = document.querySelector(&#39;#z&#39;);

// at render or update time
xElem.textContent = someObject.position.x.toFixed(3);
yElem.textContent = someObject.position.y.toFixed(3);
zElem.textContent = someObject.position.z.toFixed(3);
</code></pre>
<p>これはリアルタイムな値を見る時はとても便利です。</p>
<p><div translate="no" class="threejs_example_container notranslate">
  <div><iframe class="threejs_example notranslate" translate="no" style=" " src="/threejs/resources/editor.html?url=/threejs/lessons/..%2Fthreejs-debug-js-html-elements.html"></iframe></div>
  <a class="threejs_center" href="/threejs/lessons/../threejs-debug-js-html-elements.html" target="_blank">ここをクリックして別のウィンドウで開きます</a>
</div>

</p>
<p>または画面にデータを貼り付けるのにクリアロガーを作成する方法もあります。私はその言葉を作っただけですが、私が手がけたゲームの多くはこの解決法を使っています。
このアイデアは1フレーム分だけメッセージを表示するバッファを持つ事です。
データを表示したいコードのどの部分でも、フレームごとにバッファにデータを追加する関数を呼び出します。これは上記のデータのピースごとに要素を作成するよりもはるかに少ない作業です。</p>
<p>例えば上記のHTMLを以下のように変更してみましょう。</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-html">&lt;canvas id=&quot;c&quot;&gt;&lt;/canvas&gt;
&lt;div id=&quot;debug&quot;&gt;
  &lt;pre&gt;&lt;/pre&gt;
&lt;/div&gt;
</code></pre>
<p>この<em>クリアバックバッファ</em>を管理するための簡単なクラスを作ってみましょう。</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-js">class ClearingLogger {
  constructor(elem) {
    this.elem = elem;
    this.lines = [];
  }
  log(...args) {
    this.lines.push([...args].join(&#39; &#39;));
  }
  render() {
    this.elem.textContent = this.lines.join(&#39;\n&#39;);
    this.lines = [];
  }
}
</code></pre>
<p>次にマウスをクリックするたびに2秒間のランダムな方向に移動するメッシュを作成する簡単な例を作ってみましょう。<a href="threejs-responsive.html">レスポンシブデザイン</a>の記事から例を紹介します。</p>
<p>マウスをクリックするたびに新しい <code class="notranslate" translate="no">Mesh</code> を追加するコードは以下の通りです。</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-js">const geometry = new THREE.SphereBufferGeometry();
const material = new THREE.MeshBasicMaterial({color: &#39;red&#39;});

const things = [];

function rand(min, max) {
  if (max === undefined) {
    max = min;
    min = 0;
  }
  return Math.random() * (max - min) + min;
}

function createThing() {
  const mesh = new THREE.Mesh(geometry, material);
  scene.add(mesh);
  things.push({
    mesh,
    timer: 2,
    velocity: new THREE.Vector3(rand(-5, 5), rand(-5, 5), rand(-5, 5)),
  });
}

canvas.addEventListener(&#39;click&#39;, createThing);
</code></pre>
<p>このコードは作成したメッシュを移動させログに記録し、タイマーが切れたら削除します。</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-js">const logger = new ClearingLogger(document.querySelector(&#39;#debug pre&#39;));

let then = 0;
function render(now) {
  now *= 0.001;  // convert to seconds
  const deltaTime = now - then;
  then = now;

  ...

  logger.log(&#39;fps:&#39;, (1 / deltaTime).toFixed(1));
  logger.log(&#39;num things:&#39;, things.length);
  for (let i = 0; i &lt; things.length;) {
    const thing = things[i];
    const mesh = thing.mesh;
    const pos = mesh.position;
    logger.log(
        &#39;timer:&#39;, thing.timer.toFixed(3), 
        &#39;pos:&#39;, pos.x.toFixed(3), pos.y.toFixed(3), pos.z.toFixed(3));
    thing.timer -= deltaTime;
    if (thing.timer &lt;= 0) {
      // remove this thing. Note we don&#39;t advance `i`
      things.splice(i, 1);
      scene.remove(mesh);
    } else {
      mesh.position.addScaledVector(thing.velocity, deltaTime);
      ++i;
    }
  }

  renderer.render(scene, camera);
  logger.render();

  requestAnimationFrame(render);
}
</code></pre>
<p>以下のサンプルでマウスをクリックして下さい。</p>
<p><div translate="no" class="threejs_example_container notranslate">
  <div><iframe class="threejs_example notranslate" translate="no" style=" " src="/threejs/resources/editor.html?url=/threejs/lessons/..%2Fthreejs-debug-js-clearing-logger.html"></iframe></div>
  <a class="threejs_center" href="/threejs/lessons/../threejs-debug-js-clearing-logger.html" target="_blank">ここをクリックして別のウィンドウで開きます</a>
</div>

</p>
<h2 id="-">クエリパラメーター</h2>
<p>もう1つ覚えておきたいのは、ウェブページにはクエリパラメーターやアンカーを介してデータを渡す事ができます。検索とハッシュと呼ばれる事があります。</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">https://domain/path/?query#anchor
</code></pre><p>これを使用しオプション機能やパラメーターを渡す事ができます。</p>
<p>先ほどの例では次のようにしています。デバッグ機能はURLに <code class="notranslate" translate="no">?debug=true</code> を指定した場合にのみ表示されます。</p>
<p>まず、クエリストリングを解析するコードが必要です。</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-js">/**
  * Returns the query parameters as a key/value object. 
  * Example: If the query parameters are
  *
  *    abc=123&amp;def=456&amp;name=gman
  *
  * Then `getQuery()` will return an object like
  *
  *    {
  *      abc: &#39;123&#39;,
  *      def: &#39;456&#39;,
  *      name: &#39;gman&#39;,
  *    }
  */
function getQuery() {
  return Object.fromEntries(new URLSearchParams(window.location.search).entries());
}
</code></pre>
<p>そうすると、debug要素をデフォルトでは表示しないようにする事ができるかもしれません。</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-html">&lt;canvas id=&quot;c&quot;&gt;&lt;/canvas&gt;
+&lt;div id=&quot;debug&quot; style=&quot;display: none;&quot;&gt;
  &lt;pre&gt;&lt;/pre&gt;
&lt;/div&gt;
</code></pre>
<p>このコードをみると <code class="notranslate" translate="no">?debug=true</code> が渡された場合のみデバッグ情報を表示するのが分かります。</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-js">const query = getQuery();
const debug = query.debug === &#39;true&#39;;
const logger = debug
   ? new ClearingLogger(document.querySelector(&#39;#debug pre&#39;))
   : new DummyLogger();
if (debug) {
  document.querySelector(&#39;#debug&#39;).style.display = &#39;&#39;;
}
</code></pre>
<p><code class="notranslate" translate="no">?debug=true</code> の場合は何も渡さないように <code class="notranslate" translate="no">DummyLogger</code> を作りました。</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-js">class DummyLogger {
  log() {}
  render() {}
}
</code></pre>
<p>以下のURLを使用して確認する事ができます。</p>
<p><a target="_blank" href="../../threejs-debug-js-params.html">threejs-debug-js-params.html</a></p>
<p>上記にはデバッグ情報はありません。</p>
<p><a target="_blank" href="../../threejs-debug-js-params.html?debug=true">threejs-debug-js-params.html?debug=true</a></p>
<p>こちらにはデバッグ情報があります。</p>
<p>複数のパラメーターは <code class="notranslate" translate="no">somepage.html?someparam=somevalue&amp;someotherparam=someothervalue</code> のように&#39;&amp;&#39;で区切る事で渡せます。
このようなパラメータを使用するとあらゆる種類のオプションを渡す事ができます。
<code class="notranslate" translate="no">speed=0.01</code> のようにアプリの速度を遅くしてわかりやすくしたり、<code class="notranslate" translate="no">showHelpers=true</code> のように他のレッスンで見られる照明や影、カメラの錐台を表示するヘルパーを追加してもいいかもしれません。</p>
<h2 id="-">デバッガの使い方を学ぶ</h2>
<p>どのブラウザにもデバッガがあり、プログラムを1行ごとに一時停止し全ての変数を検査する事ができます。</p>
<p>デバッガの使い方を教えるのはあまりにも大きなトピックなので、ここではいくつかのリンクを紹介します。</p>
<ul>
<li><a href="https://developers.google.com/web/tools/chrome-devtools/javascript/">Chrome DevTools で JavaScript をデバッグする</a></li>
<li><a href="https://javascript.info/debugging-chrome">Debugging in Chrome</a></li>
<li><a href="https://hackernoon.com/tips-and-tricks-for-debugging-in-chrome-developer-tools-458ade27c7ab">Tips and Tricks for Debugging in Chrome Developer Tools</a></li>
</ul>
<h2 id="-nan-">デバッガなどで <code class="notranslate" translate="no">NaN</code> がないかチェックする</h2>
<p><code class="notranslate" translate="no">NaN</code> は Not A Numberの略です。これは数学的に意味のない事をした場合、JavaScript が値として代入するものです。</p>
<p>簡単な例としては</p>
<div class="threejs_center"><img class="border" src="../resources/images/nan-banana.png" style="width: 180px;"></div>

<p>何か開発中に画面に何も表示されない事がよくあるので、私は <code class="notranslate" translate="no">NaN</code> が表示されたらその場所からすぐにいくつかの値を確認します。</p>
<p>例として最初に<a href="threejs-load-gltf.html">gLTFファイルの読込</a>の記事でパスを作り始めた時に2次元曲線を作るSplineCurveクラスを使って曲線を作ってみました。</p>
<p>そのカーブを利用してこのように車を動かしました。</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-js">curve.getPointAt(zeroToOnePointOnCurve, car.position);
</code></pre>
<p>内部的には <code class="notranslate" translate="no">curve.getPointAt</code> は第2引数に渡されたオブジェクトに対して <code class="notranslate" translate="no">set</code> 関数を呼び出します。この場合、第2引数は <code class="notranslate" translate="no">car.position</code> であり、これは <code class="notranslate" translate="no">Vector3</code> です。<code class="notranslate" translate="no">Vector3</code> の <code class="notranslate" translate="no">set</code> 関数はx, y, zの3つの引数を必要としますが、<code class="notranslate" translate="no">SplineCurve</code> は2次元曲線なので、xとyだけを指定して <code class="notranslate" translate="no">car.position.set</code> を呼び出します。</p>
<p>その結果、<code class="notranslate" translate="no">car.position.set</code> はxにx、yにy、zに <code class="notranslate" translate="no">undefined</code> をセットします。</p>
<p>デバッガで <code class="notranslate" translate="no">matrixWorld</code> を見てみると <code class="notranslate" translate="no">NaN</code> 値が表示されています。</p>
<div class="threejs_center"><img class="border" src="../resources/images/debugging-nan.gif" style="width: 476px;"></div>

<p>行列を見ると <code class="notranslate" translate="no">NaN</code> が含まれており、<code class="notranslate" translate="no">position</code>、 <code class="notranslate" translate="no">rotation</code>、 <code class="notranslate" translate="no">scale</code> または他の関数に悪い影響を与えるデータがあるのが見えます。これらの悪いデータから逆算すると問題を追跡するのは簡単です。</p>
<p><code class="notranslate" translate="no">NaN</code> の上には <code class="notranslate" translate="no">Infinity</code> もありますが、これはどこかに数学のバグがあるような気がします。</p>
<h2 id="-">コードの中を見て！</h2>
<p>THREE.jsはオープンソースです。コードの中を見る事を恐れないで下さい！
<a href="https://github.com/mrdoob/three.js">github</a>で内部コードを見れます。
また、デバッガの関数を踏み込んで内部を見る事もできます。その際には <code class="notranslate" translate="no">three.min.js</code> でなく <code class="notranslate" translate="no">three.js</code> を見るようにして下さい。<code class="notranslate" translate="no">three.min.js</code> は最小化・圧縮されたバージョンなので、ダウンロードする際のサイズが小さくなっています。<code class="notranslate" translate="no">three.js</code> はサイズは大きいですが、デバッグしやすいバージョンです。私はよく <code class="notranslate" translate="no">three.js</code> に切り替えて、コードのステップスルーを行い、何が起こっているのかを確認しています。</p>
<h2 id="-requestanimationframe-render-"><code class="notranslate" translate="no">requestAnimationFrame</code> はrender関数の一番下へ</h2>
<p>以下のパターンはよく見かけます。</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-js">function render() {
   requestAnimationFrame(render);

   // -- do stuff --

   renderer.render(scene, camera);
}
requestAnimationFrame(render);
</code></pre>
<p>以下のように <code class="notranslate" translate="no">requestAnimationFrame</code> を一番下に置く事をお勧めします。</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-js">function render() {
   // -- do stuff --

   renderer.render(scene, camera);

   requestAnimationFrame(render);
}
requestAnimationFrame(render);
</code></pre>
<p>最大の理由はエラーが発生した場合にコードが停止する事です。
<code class="notranslate" translate="no">requestAnimationFrame</code> を先頭に置くと、既に別のフレームを要求しているためにエラーが発生してもコードを実行し続けます。
IMOを無視するよりも、それらのエラーを見つける方が良いでしょう。これらのエラーは何かが期待したように表示されない原因になりやすいのですが、コードが停止しない限り、気がつかないかもしれません。</p>
<h2 id="-">単位をチェックして下さい！</h2>
<p>角度やラジアンを使う時の例を知っておく必要があります。
残念ながらTHREE.jsではどこでも同じ単位を使用している訳ではありません。
すぐに思いつくのだとカメラの視野は度単位です。それ以外の角度は全てラジアン単位です。</p>
<p>もう1つ注目したいのは、世界単位のサイズです。最近の3Dアプリでは好きな単位を選べるようになっています。あるアプリでは1単位＝1cmを選択する事があります。もう1つのアプリでは1台＝1フィートを選ぶかもしれません。特定のアプリケーションでは必要なユニットを選択する事ができます。three.jsでは1単位＝1メートルを想定しています。
これは測定器を使用して照明効果を計算する物理ベースのレンダリングなどで重要です。
スマホがどこにあるか、VRコントローラーがどこにあるかなど、現実世界の単位を扱う必要があるARやVRにとっても重要です。</p>
<h2 id="-">スタックオーバーフローのための <em>最小で完全で検証可能なサンプルコード</em> の作成</h2>
<p>THREE.jsの質問をする場合、MCVE（Minimal&lt;最小&gt;、Complete&lt;完全&gt;、Verifiable&lt;検証可能&gt;、Example&lt;サンプル&gt;の略）のコードを提供する事が求められます。</p>
<p><strong>最小</strong>の部分が重要です。<a href="threejs-load-gltf.html">gLTF読込の記事</a>の最後のサンプルコードでパスの動きに問題があったとしましょう。そのサンプルには多くのパーツがあり、リストアップすると</p>
<ol>
<li>HTMLの集まり</li>
<li>いくつかのCSS</li>
<li>ライティング</li>
<li>影</li>
<li>影を操作するためのDAT.guiコード</li>
<li>GLTFファイルの読込コード</li>
<li>キャンバスのリサイズコード</li>
<li>パスに沿って車を移動させるコード</li>
</ol>
<p>このコードはかなり大きいです。もし質問がパスの後に続く部分だけであれば、THREE.jsの <code class="notranslate" translate="no">&lt;canvas&gt;</code> と <code class="notranslate" translate="no">&lt;script&gt;</code> タグだけで済むので、ほとんどのHTMLを削除する事ができます。また、CSSとリサイズのコードを削除する事ができます。GLTFのコードもパスだけを気にしているので削除できます。<code class="notranslate" translate="no">MeshBasicMaterial</code> を使用するとライトとシャドウも削除する事ができます。DAT.guiのコードも確実に削除できます。
このコードはテクスチャ付きの地面を作ります。<code class="notranslate" translate="no">GridHelper</code> を使った方が簡単です。
最終的にもし質問したい事がパス上での移動についてなら、ロードされた車モデルの代わりにパス上にキューブを使用する事ができます。</p>
<p>以上の事を考慮したミニマムなサンプルコードを紹介します。271行から135行に縮小しました。パスを単純化する事でさらに縮小する事も考られます。3,4点のパスは、21点のパスと同じように動作するかもしれません。</p>
<p><div translate="no" class="threejs_example_container notranslate">
  <div><iframe class="threejs_example notranslate" translate="no" style=" " src="/threejs/resources/editor.html?url=/threejs/lessons/..%2Fthreejs-debugging-mcve.html"></iframe></div>
  <a class="threejs_center" href="/threejs/lessons/../threejs-debugging-mcve.html" target="_blank">ここをクリックして別のウィンドウで開きます</a>
</div>

</p>
<p><code class="notranslate" translate="no">OrbitController</code> を残してるのはカメラを動かして何が起こっているのかを把握するのに便利だからですが、問題によってはこれも削除できるかもしれません。</p>
<p>MCVEを作る上で一番良い点は、自分自身で解決する事が多いという事です。不要なものを取り除いて可能な限り小さなサンプルコードを作って問題を再現する事で、バグにたどり着く事が多いからです。</p>
<p>その上でStack Overflowで自分のコードを見てもらうのは、回答者の時間を尊重する事になります。最小限のサンプルを作る事で、誰かがあなたを助ける事がはるかに簡単になります。また、その過程で以下を学ぶ事ができます。</p>
<p>Stack Overflowに質問を投稿する際、<strong>コードを<a href="https://stackoverflow.blog/2014/09/16/introducing-runnable-javascript-css-and-html-code-snippets/">スニペット</a></strong>にする事が重要です。
もちろん、MCVEを試すためにJSFiddleやCodepen、または同様のサイトを使用する事は歓迎しますが、実際にStack Overflowに質問を投稿するようになったら、<strong>質問自体に</strong>問題を再現するためのコードを記述する必要があります。
スニペットを作る事でその条件を満たしています。</p>
<p>また、このサイト上の全てのライブサンプルはスニペットとして実行されるべきである事に注意して下さい。HTML、CSS、JavaScriptの部分を<a href="https://stackoverflow.blog/2014/09/16/introducing-runnable-javascript-css-and-html-code-snippets/">スニペットエディタ</a>のそれぞれの部分にコピーするだけです。ただし、自分の問題に関係のない部分を削除し、必要最低限のコードにするのを忘れないようにして下さい。</p>
<p>これらに従えば、あなたの問題は助けを得る可能性がはるかに高くなります。</p>
<h2 id="-meshbasicmaterial-"><code class="notranslate" translate="no">MeshBasicMaterial</code> を使用する</h2>
<p><code class="notranslate" translate="no">MeshBasicMaterial</code> はライトを使用しないので、何かが表示されない理由を取り除く1つの方法です。もしオブジェクトが <code class="notranslate" translate="no">MeshBasicMaterial</code> を使用して表示されない場合は、コードの他の部分ではなくマテリアルやライトに問題がある可能性が高い事がわかります。</p>
<h2 id="-near-far-">カメラの <code class="notranslate" translate="no">near</code> と <code class="notranslate" translate="no">far</code> の設定を確認する</h2>
<p><code class="notranslate" translate="no">PerspectiveCamera</code> には <code class="notranslate" translate="no">near</code> と <code class="notranslate" translate="no">far</code> の設定があり、それは<a href="threejs-cameras.html">カメラの記事</a> で説明しています。
オブジェクトを含む空間に合わせて設定されている事を確認して下さい。
例えば <code class="notranslate" translate="no">near</code> = 0.001、<code class="notranslate" translate="no">far</code> = 1000000のような大きな値に<strong>一時的に</strong>設定する事もできます。
奥行き解像度の問題が発生する可能性がありますが、少なくともカメラの前にあるオブジェクトを見る事ができるようになります。</p>
<h2 id="-">カメラの前にシーンがある事を確認する</h2>
<p>時にはカメラの前になく何も出てこない事もあります。カメラを制御できない場合は <code class="notranslate" translate="no">OrbitController</code> のようなカメラコントロールを追加してみて下さい。
あるいは<a href="threejs-load-obj.html">この記事</a>で紹介されているコードを使ってシーンをフレーミングしてみて下さい。
このコードはシーンの一部のサイズを見つけ、カメラを移動して <code class="notranslate" translate="no">near</code> と <code class="notranslate" translate="no">far</code> の設定を調整し、それが見えるようにします。</p>
<h2 id="-">カメラの前に何かを置く</h2>
<p>これは全てに失敗した場合は、動作するものから始めてゆっくりと何かを追加していくという方法です。何もない画面が表示された場合は、直接カメラの前に何かを置いてみて下さい。
球体や箱を作り <code class="notranslate" translate="no">MeshBasicMaterial</code>のようなシンプルなマテリアルを与えて、それを画面上に表示できるようにします。
その後、少しずつ追加してテストを開始します。最終的にはバグを再現するか、途中で発見するかのどちらかになります。</p>
<hr>
<p>以上、JavaScriptのデバッグのヒントでした。<a href="threejs-debugging-glsl.html">GLSLをデバッグするためのいくつかのヒント</a>も見てみましょう。</p>

    </div>
    <div class="lesson-sidebar">
        <select class="language">
    <option value="/threejs/lessons/threejs-debugging-javascript.html" >English</a>
    <option value="/threejs/lessons/fr/threejs-debugging-javascript.html" >Français</a>
    <option value="/threejs/lessons/ja/threejs-debugging-javascript.html" selected>日本語</a>
    <option value="/threejs/lessons/kr/threejs-debugging-javascript.html" >한국어</a>
    <option value="/threejs/lessons/ru/threejs-debugging-javascript.html" >Русский</a>
    <option value="/threejs/lessons/zh_cn/threejs-debugging-javascript.html" >中文</a>
</select>


        <div id="toc">
          <ul>  <li>基本</li>
        <ul>
          <li><a href="/threejs/lessons/ja/threejs-fundamentals.html">基礎知識</a></li>
<li><a href="/threejs/lessons/ja/threejs-responsive.html">レスポンシブデザイン</a></li>
<li><a href="/threejs/lessons/ja/threejs-prerequisites.html">前提条件</a></li>
<li><a href="/threejs/lessons/ja/threejs-setup.html">セットアップ</a></li>
        </ul>
  <li>基礎</li>
        <ul>
          <li><a href="/threejs/lessons/ja/threejs-primitives.html">プリミティブ</a></li>
<li><a href="/threejs/lessons/ja/threejs-scenegraph.html">シーングラフ</a></li>
<li><a href="/threejs/lessons/ja/threejs-materials.html">マテリアル</a></li>
<li><a href="/threejs/lessons/ja/threejs-textures.html">テクスチャ</a></li>
<li><a href="/threejs/lessons/ja/threejs-lights.html">Lights</a></li>
<li><a href="/threejs/lessons/ja/threejs-cameras.html">Cameras</a></li>
<li><a href="/threejs/lessons/ja/threejs-shadows.html">Shadows</a></li>
<li><a href="/threejs/lessons/ja/threejs-fog.html">Fog</a></li>
<li><a href="/threejs/lessons/ja/threejs-rendertargets.html">Render Targets</a></li>
<li><a href="/threejs/lessons/ja/threejs-custom-geometry.html">Custom Geometry</a></li>
<li><a href="/threejs/lessons/ja/threejs-custom-buffergeometry.html">Custom BufferGeometry</a></li>
        </ul>
  <li>Tips</li>
        <ul>
          <li><a href="/threejs/lessons/ja/threejs-rendering-on-demand.html">要求されたレンダリング</a></li>
<li><a href="/threejs/lessons/ja/threejs-debugging-javascript.html">JavaScriptのデバッグ</a></li>
<li><a href="/threejs/lessons/ja/threejs-debugging-glsl.html">GLSLのデバッグ</a></li>
<li><a href="/threejs/lessons/ja/threejs-tips.html#screenshot">スクリーンショットを撮る</a></li>
<li><a href="/threejs/lessons/ja/threejs-tips.html#preservedrawingbuffer">キャンバスがクリアされるのを防ぐ</a></li>
<li><a href="/threejs/lessons/ja/threejs-tips.html#tabindex">キャンバスからキーボード入力を取得する</a></li>
<li><a href="/threejs/lessons/ja/threejs-tips.html#transparent-canvas">キャンバスを透明にする</a></li>
<li><a href="/threejs/lessons/ja/threejs-tips.html#html-background">HTMLの背景にthree.jsを使う</a></li>
        </ul>
  <li>最適化</li>
        <ul>
          <li><a href="/threejs/lessons/ja/threejs-optimize-lots-of-objects.html">多くのオブジェクトを最適化</a></li>
<li><a href="/threejs/lessons/ja/threejs-optimize-lots-of-objects-animated.html">アニメーションする多くのオブジェクトを最適化</a></li>
<li><a href="/threejs/lessons/ja/threejs-offscreencanvas.html">Using OffscreenCanvas in a Web Worker</a></li>
        </ul>
  <li>解決策</li>
        <ul>
          <li><a href="/threejs/lessons/ja/threejs-load-obj.html">Load an .OBJ file</a></li>
<li><a href="/threejs/lessons/ja/threejs-load-gltf.html">Load a .GLTF file</a></li>
<li><a href="/threejs/lessons/ja/threejs-backgrounds.html">Add a Background or Skybox</a></li>
<li><a href="/threejs/lessons/ja/threejs-transparency.html">How to Draw Transparent Objects</a></li>
<li><a href="/threejs/lessons/ja/threejs-multiple-scenes.html">Multiple Canvases, Multiple Scenes</a></li>
<li><a href="/threejs/lessons/ja/threejs-picking.html">Picking Objects with the mouse</a></li>
<li><a href="/threejs/lessons/ja/threejs-post-processing.html">Post Processing</a></li>
<li><a href="/threejs/lessons/ja/threejs-post-processing-3dlut.html">Applying a LUT File for effects</a></li>
<li><a href="/threejs/lessons/ja/threejs-shadertoy.html">Using Shadertoy shaders</a></li>
<li><a href="/threejs/lessons/ja/threejs-align-html-elements-to-3d.html">Aligning HTML Elements to 3D</a></li>
<li><a href="/threejs/lessons/ja/threejs-indexed-textures.html">Using Indexed Textures for Picking and Color</a></li>
<li><a href="/threejs/lessons/ja/threejs-canvas-textures.html">Using A Canvas for Dynamic Textures</a></li>
<li><a href="/threejs/lessons/ja/threejs-billboards.html">Billboards and Facades</a></li>
<li><a href="/threejs/lessons/ja/threejs-cleanup.html">Freeing Resources</a></li>
<li><a href="/threejs/lessons/ja/threejs-voxel-geometry.html">Making Voxel Geometry (Minecraft)</a></li>
<li><a href="/threejs/lessons/ja/threejs-game.html">Start making a Game.</a></li>
        </ul>
  <li>WebVR</li>
        <ul>
          <li><a href="/threejs/lessons/ja/threejs-webvr.html">VR - Basics</a></li>
<li><a href="/threejs/lessons/ja/threejs-webvr-look-to-select.html">VR - Look To Select</a></li>
<li><a href="/threejs/lessons/ja/threejs-webvr-point-to-select.html">VR - Point To Select</a></li>
        </ul>
  <li>参照</li>
        <ul>
          <li><a href="/threejs/lessons/ja/threejs-material-table.html">Material Table</a></li>
        </ul></ul>
<ul>
  <li><a href="https://github.com/gfxfundamentals/threejsfundamentals">github</a></li>
  <li><a href="https://threejs.org">three.js</a></li>
  <li><a href="https://threejs.org/docs/">three.jsドキュメント</a></li>
</ul>

        </div>
    </div>
    <div class="lesson-comments">
        <div>質問はありますか? <a href="http://stackoverflow.com/questions/tagged/three.js">何かあればstackoverflowで尋ねて下さい</a>.</div>
        <div>Issue/Bug? <a href="http://github.com/greggman/threefundamentals/issues">またはgithubでissueを作って下さい</a>.</div>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'threejsfundamentals'; // required: replace example with your forum shortname
            var disqus_identifier = 'Three.jsでのJavaScriptデバッグ';
            var disqus_title = 'Three.jsでのJavaScriptデバッグ';

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                if (window.location.hostname.indexOf("threejsfundamentals.org") < 0) {
                    return;
                }
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
  </div>
</div>
</body>
<script src="/3rdparty/jquery-3.3.1.slim.min.js"></script>
<script src="/threejs/lessons/resources/prettify.js"></script>
<script src="/threejs/lessons/resources/lesson.js"></script>
<script>
(function() {
  if (window.location.hostname.indexOf("threejsfundamentals.org") < 0) {
      return;
  }

  function addScript(src, fn) {
    const script = document.createElement('script');
    const firstScript = document.getElementsByTagName('script')[0];
    script.async = true;
    script.defer = true;
    if (fn) {
      script.addEventListener('load', fn);
    }
    script.src = src;
    firstScript.parentNode.insertBefore(script, firstScript);
  }

  addScript('//cdn.webglstats.com/stat.js');
  addScript('https://www.googletagmanager.com/gtag/js?id=UA-120733518-1', () => {
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-120733518-1');
  });
}());
</script>


</html>



